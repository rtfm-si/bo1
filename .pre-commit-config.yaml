repos:
  - repo: local
    hooks:
      # Version sync check (runs first, fast)
      - id: version-sync
        name: Version sync check
        entry: ./scripts/bump-version.sh check
        language: system
        pass_filenames: false
        files: ^(VERSION|pyproject\.toml|frontend/package\.json|frontend/src/lib/config/version\.ts|bo1/__init__\.py)$

      # Backend linting
      - id: ruff-check
        name: Backend linting (ruff check)
        entry: docker-compose run --rm bo1 uv run ruff check . --fix
        language: system
        pass_filenames: false
        always_run: true

      - id: ruff-format
        name: Backend formatting (ruff format)
        entry: docker-compose run --rm bo1 uv run ruff format .
        language: system
        pass_filenames: false
        always_run: true

      - id: mypy-bo1
        name: Backend type checking (mypy)
        entry: docker-compose run --rm bo1 uv run mypy bo1/
        language: system
        pass_filenames: false
        always_run: true

      # Frontend checks
      - id: frontend-typecheck
        name: Frontend type checking
        entry: bash -c "cd frontend && npm run check"
        language: system
        pass_filenames: false
        files: ^frontend/

      - id: types-freshness
        name: Check generated types freshness
        entry: bash -c "cd frontend && npm run check:types-fresh"
        language: system
        pass_filenames: false
        files: ^(openapi\.json|frontend/src/lib/api/generated-types\.ts)$

      # Fast backend tests (no LLM)
      - id: backend-tests-fast
        name: Backend tests (no LLM)
        entry: docker-compose run --rm bo1 pytest -v -m "not requires_llm" --tb=line
        language: system
        pass_filenames: false
        always_run: true
