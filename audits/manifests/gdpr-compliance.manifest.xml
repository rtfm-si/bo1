<?xml version="1.0" encoding="UTF-8"?>
<audit_manifest type="gdpr-compliance" version="1.0">
  <metadata>
    <title>GDPR Compliance Audit</title>
    <description>Audit compliance with UK GDPR and Data Protection Act 2018</description>
    <created>2025-12-12</created>
    <scope>
      <include>backend/api/user.py</include>
      <include>backend/services/gdpr.py</include>
      <include>backend/services/audit.py</include>
      <include>backend/jobs/session_cleanup.py</include>
      <include>frontend/src/routes/legal/privacy/+page.svelte</include>
      <include>frontend/src/lib/components/CookieConsent.svelte</include>
      <include>migrations/versions/l1_add_gdpr_audit_log.py</include>
    </scope>
  </metadata>

  <checklist>
    <category name="Art. 12-14 Transparency">
      <item id="T1">Privacy policy accessible and up-to-date</item>
      <item id="T2">Data controller identity disclosed</item>
      <item id="T3">Processing purposes documented</item>
      <item id="T4">Legal basis for processing stated</item>
      <item id="T5">Data recipients disclosed</item>
      <item id="T6">Retention periods disclosed</item>
      <item id="T7">User rights documented</item>
      <item id="T8">DPO contact information provided</item>
      <item id="T9">International transfer disclosures</item>
    </category>

    <category name="Art. 15 Right of Access">
      <item id="A1">Data export endpoint exists</item>
      <item id="A2">Export includes all PII categories</item>
      <item id="A3">Export format is machine-readable (JSON)</item>
      <item id="A4">Rate limiting prevents abuse</item>
      <item id="A5">Audit trail for export requests</item>
    </category>

    <category name="Art. 17 Right to Erasure">
      <item id="E1">Deletion endpoint exists</item>
      <item id="E2">All data categories covered</item>
      <item id="E3">Storage files deleted (DO Spaces)</item>
      <item id="E4">Sessions/sessions tokens invalidated</item>
      <item id="E5">Redis cache cleared</item>
      <item id="E6">Audit trail for deletion requests</item>
    </category>

    <category name="Art. 6/7 Consent">
      <item id="C1">Cookie consent mechanism</item>
      <item id="C2">Consent timestamp recorded</item>
      <item id="C3">Granular consent options (essential vs analytics)</item>
      <item id="C4">Consent withdrawal mechanism</item>
      <item id="C5">Third-party sharing consent</item>
    </category>

    <category name="Art. 30 Processing Records">
      <item id="P1">Processing activities documented</item>
      <item id="P2">Sub-processors listed</item>
      <item id="P3">DPAs in place</item>
    </category>

    <category name="Art. 32 Security">
      <item id="S1">Encryption at rest</item>
      <item id="S2">Encryption in transit</item>
      <item id="S3">Access controls</item>
      <item id="S4">Security audit performed</item>
    </category>

    <category name="Data Retention">
      <item id="R1">Retention periods defined</item>
      <item id="R2">Automated cleanup job exists</item>
      <item id="R3">Retention configurable per category</item>
    </category>
  </checklist>

  <expected_outputs>
    <output type="report">audits/reports/gdpr-compliance.report.md</output>
  </expected_outputs>

  <severity_levels>
    <level name="critical">Immediate regulatory risk, must fix before launch</level>
    <level name="high">Significant compliance gap, fix within 2 weeks</level>
    <level name="medium">Minor compliance gap, fix within 1 month</level>
    <level name="low">Enhancement opportunity, add to backlog</level>
  </severity_levels>
</audit_manifest>
