# Infrastructure Security Audit Manifest

<audit_manifest>
  <audit_type>infra-security</audit_type>

  <purpose>
    Audit network configuration, secrets management, container security, logging,
    and backup procedures for security gaps across dev, staging, and production.
  </purpose>

  <scope>
    - Docker/compose network and port bindings
    - Container security (base images, user permissions, capabilities)
    - Secrets management (env vars, hardcoded secrets, git history)
    - Logging security (sensitive data exposure, retention, access)
    - Backup and disaster recovery (Postgres, Redis persistence)
    - CORS and external access controls
  </scope>

  <constraints>
    - Follow CLAUDE.md, GOVERNANCE, CONTEXT_BOUNDARY, MODEL_GUIDANCE
    - Document findings with evidence and location
    - Severity levels: Critical/High/Medium/Low/Info
    - Include effort estimates for remediations
    - No full-file dumps unless essential
  </constraints>

  <required_inputs>
    - docker-compose.yml (dev)
    - docker-compose.prod.yml (production)
    - docker-compose.infrastructure.yml (monitoring)
    - Dockerfiles (backend, frontend)
    - .env.example and env var documentation
    - Loki/Promtail configurations
    - CORS configuration in FastAPI
    - .gitignore for secrets exclusion
  </required_inputs>

  <expected_outputs>
    - Network exposure assessment
    - Secrets inventory with risk classification
    - Container security findings
    - Logging security findings
    - Backup/recovery status
    - Prioritized remediation list with effort
    - Final report: audits/reports/infra-security.report.md
  </expected_outputs>

  <severity_definitions>
    <severity name="Critical">Immediate exploitation possible, data breach risk</severity>
    <severity name="High">Significant risk, requires near-term remediation</severity>
    <severity name="Medium">Moderate risk, should address within release cycle</severity>
    <severity name="Low">Minor risk, address when convenient</severity>
    <severity name="Info">Best practice recommendation, no immediate risk</severity>
  </severity_definitions>

  <activation_conditions>
    - Before production deployment
    - After infrastructure changes
    - After adding new services or ports
    - Quarterly infrastructure review
  </activation_conditions>

  <run_pattern>
    1. Load manifest and verify scope
    2. Audit network configuration (ports, exposure, CORS)
    3. Audit secrets management (env vars, git, hardcoded)
    4. Audit container security (images, users, volumes)
    5. Audit logging configuration (sensitive data, retention)
    6. Audit backup and recovery procedures
    7. Write report to audits/reports/infra-security.report.md
  </run_pattern>
</audit_manifest>
