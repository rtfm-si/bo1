# Observability Audit Manifest

<audit_manifest>
  <audit_type>observability</audit_type>

  <purpose>
    Assess logging, metrics, tracing, and alerting coverage. Ensure production issues can be diagnosed from available telemetry.
  </purpose>

  <scope>
    - Structured logging patterns and levels
    - Error handling and exception propagation
    - Health check endpoints
    - Cost and usage tracking
    - Event stream observability
  </scope>

  <constraints>
    - Focus on observability gaps, not implementation details
    - Do not expose sensitive data patterns
    - Respect GOVERNANCE security constraints
    - Audit configuration, not runtime behavior
  </constraints>

  <required_inputs>
    - backend/api/health.py
    - bo1/llm/cost_tracker.py
    - backend/api/event_collector.py
    - Logging configuration in backend/api/main.py
    - Any monitoring config files
  </required_inputs>

  <expected_outputs>
    - Logging coverage map (which components log what)
    - Missing observability points
    - Health check completeness assessment
    - Alert threshold recommendations
    - Tracing correlation ID coverage
  </expected_outputs>

  <activation_conditions>
    - Before production deployment
    - After adding new services/components
    - When debugging production issues is difficult
    - Quarterly observability review
  </activation_conditions>

  <run_pattern>
    1. Inventory logging statements by component
    2. Check health endpoint coverage
    3. Verify error propagation includes context
    4. Assess cost tracking completeness
    5. VERIFY existing implementations before generating tasks (see verification_checks)
    6. Output report to /audits/reports/observability.report.md
  </run_pattern>

  <verification_checks>
    Before generating any task, verify it is NOT already implemented:

    - Redis metrics: Check backend/api/middleware/metrics.py and health.py for redis_pool_* metrics
    - Prometheus metrics: Grep for prometheus_client or Counter/Gauge/Histogram in target files
    - Structured logging: Check if structlog or JSON logging already configured in target component
    - Correlation IDs: Grep for correlation_id or request_id in middleware and handlers
    - Health endpoints: Check /health and /readyz endpoints in backend/api/health.py
    - Error metrics: Check for error_rate or *_errors_total metrics in metrics.py

    Skip generating tasks for items that already have implementations.
    If partial implementation exists, generate task for remaining work only.
  </verification_checks>
</audit_manifest>
